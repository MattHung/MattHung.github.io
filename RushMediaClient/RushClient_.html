<html>
<head>
    <script type="text/javascript" src="Setting.js"></script>
</head>
<body onload="load()">
    <script type="text/javascript">
        //        logger.swithLogger("panel");
        logger.disableLogger();

        var Options={};

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        function switchResolution(w, h, b){
            var json_str = JSON.stringify({
                action: "switch_chanel",
                width: w,
                height: h,
                bitrate: b
            });
            wsavc.send(json_str);
        }

        function onopen(open){
            switchResolution(getParameterByName("width"), getParameterByName("height"), getParameterByName("bitrate"));
        }

        function onwsmessage(json_obj){

//            switch(json_obj.action){
//                case "source_list":
//                        for(var i=0; i<json_obj.source.length; i++) {
//                            var resolution=json_obj.source[i].width.toString() + "x" + json_obj.source[i].height.toString();
//                            var option = Options[resolution];
//                            if(option==undefined) {
//                                Options[resolution] = [];
//                                option = Options[resolution];
//                            }
//
//                            Options[resolution].push(json_obj.source[i]);
//                        }
//
//                        for(var option in Options) {
//                            option = Options[option];
//                            for (var i = 0; i < option.length; i++) {
//                                var element = document.createElement("input");
//                                //Assign different attributes to the element.
//                                element.type = "button";
//                                element.name = "button_" + (json_obj.source.length - 1).toString();  // And the name too?
//
//                                element.value = option[i].width.toString() +
//                                "x" + option[i].height.toString() +
//                                "   b:" + option[i].bitrate;
//
//                                element.setAttribute("width", option[i].width);
//                                element.setAttribute("height", option[i].height);
//                                element.setAttribute("bitrate", option[i].bitrate);
//
//                                element.onclick = function () { // Note this is a function
//                                    switchResolution(this.getAttribute("width"), this.getAttribute("height"), this.getAttribute("bitrate"));
//                                };
//
//                                document.getElementById("Settings").appendChild(element);
//                            }
//
//                            document.getElementById("Settings").appendChild(document.createElement("br"));
//                        }
//                    break;
//            }
        }

        function onerror(error){}

        function onclose(close){}

        function load()
        {
            wsavc.connect("ws://192.168.154.244:50480");
            wsavc.onwsopen = onopen;
            wsavc.onwsmessage = onwsmessage;
            wsavc.onwserror = onerror;
            wsavc.onwsclose = onclose;

//            setInterval(function(){
//                document.getElementById("Latency").innerHTML = "Latency =" + wsavc.Latency.toString() + " ms" ;
//            }, 500);
        }

    </script>

    <!--<script type="text/javascript" src="Converter.min.js"></script>-->

    <canvas id="ScreenCanvas"></canvas>
    <div id="Settings"></div>

    <!--<div id="Latency"></div>-->

    <script type="text/javascript" src="main.js"></script>
</body>
</html>